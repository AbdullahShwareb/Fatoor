<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>ÙÙˆØ§ØªÙŠØ± Ù…Ø­Ù„Ø§Øª Ø£ÙŠÙ…Ù† Ø£Ø¨Ùˆ Ø§Ù„Ø´ÙˆØ§Ø±Ø¨</title>
  <style>
    body {
      font-family: "Tahoma","Arial","Noto Naskh Arabic",sans-serif;
      margin:20px; direction:rtl; background:#f5f7fb;
    }
    h1 {text-align:center; margin-bottom:15px;}
    table {width:100%; border-collapse:collapse; margin-top:20px; table-layout:fixed;}
    th,td {
      border:1px solid #ddd;
      padding:8px;
      text-align:center;
      vertical-align:middle;
      word-wrap:break-word;
      white-space:normal;
    }
    thead th {background:#e7efff; font-weight:bold;}
    tbody tr:nth-child(odd){background:#f9f9f9;}
    tfoot td {font-weight:bold; background:#eef4ff;}
    input {
      width:100%;
      border:none;
      padding:6px;
      text-align:center;
      background:transparent;
    }
    td.name-cell {width: 40%;}
    td.name-cell input {
      text-align:right;
      white-space:normal;
      word-wrap:break-word;
      width:100%;
    }
    .total-input {background:#f3f4f6;}
    .actions {
      margin:15px 0;
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
    }
    button {
      padding:6px 10px;
      border-radius:6px;
      border:1px solid #0d6efd;
      background:#0d6efd;
      color:#fff;
      cursor:pointer;
    }
    button.outline {background:#fff; color:#0d6efd;}
    .del-btn {background:#dc3545; border-color:#dc3545;}
    .clear-btn {background:#6c757d; border-color:#6c757d;}
    @media print {
      .no-print{display:none;}
      input{border:none;}
      body{background:#fff;}
    }
  </style>
</head>
<body>
  <h1>ÙÙˆØ§ØªÙŠØ± Ù…Ø­Ù„Ø§Øª Ø£ÙŠÙ…Ù† Ø£Ø¨Ùˆ Ø§Ù„Ø´ÙˆØ§Ø±Ø¨</h1>

  <div class="actions no-print">
    <button id="add">â• Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø±</button>
    <button class="outline" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
    <button class="clear-btn" id="clear">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
  </div>

  <table id="tbl">
    <thead>
      <tr>
        <th style="width:40px">#</th>
        <th class="name-cell">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
        <th style="width:120px">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
        <th style="width:140px">Ø§Ù„Ø³Ø¹Ø±/Ø­Ø¨Ø©</th>
        <th style="width:140px">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
        <th class="no-print" style="width:80px">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
      </tr>
    </thead>
    <tbody id="body"></tbody>
    <tfoot>
      <tr>
        <td colspan="4">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ</td>
        <td><input id="grand" class="total-input" readonly value="0.00"></td>
        <td></td>
      </tr>
    </tfoot>
  </table>

  <script>
    const bodyEl = document.getElementById('body');
    const grandEl = document.getElementById('grand');
    const addBtn = document.getElementById('add');
    const clearBtn = document.getElementById('clear');

    function fmt(n){return (n||0).toFixed(2);}
    function num(v){const n=parseFloat(v);return isNaN(n)?0:n;}

    function saveData(){
      const rows=[];
      bodyEl.querySelectorAll('tr').forEach(tr=>{
        rows.push({
          name: tr.querySelector('.name').value,
          qty: tr.querySelector('.qty').value,
          price: tr.querySelector('.price').value
        });
      });
      localStorage.setItem('fatoraRows', JSON.stringify(rows));
    }

    function loadData(){
      const data=JSON.parse(localStorage.getItem('fatoraRows')||'[]');
      data.forEach(r=>addRow(r.name,r.qty,r.price));
      calc();
    }

    function calc(){
      let g=0;
      bodyEl.querySelectorAll('tr').forEach(tr=>{
        const q=num(tr.querySelector('.qty').value);
        const p=num(tr.querySelector('.price').value);
        const total=q*p;
        tr.querySelector('.total').value=fmt(total);
        g+=total;
      });
      grandEl.value=fmt(g);
      saveData();
    }

    function addRow(name="",qty=1,price=0){
      const i = bodyEl.querySelectorAll('tr').length+1;
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td class="index">${i}</td>
        <td class="name-cell"><input class="name" value="${name}"></td>
        <td><input type="number" class="qty" value="${qty}"></td>
        <td><input type="number" step="0.01" class="price" value="${price}"></td>
        <td><input class="total total-input" readonly value="0.00"></td>
        <td class="no-print"><button class="del-btn">ğŸ—‘ï¸</button></td>
      `;
      bodyEl.appendChild(tr);

      tr.querySelector('.qty').addEventListener('input', calc);
      tr.querySelector('.price').addEventListener('input', calc);
      tr.querySelector('.name').addEventListener('input', saveData);
      tr.querySelector('.del-btn').addEventListener('click', ()=>{
        tr.remove();
        renumber();
        calc();
      });

      calc();
    }

    function renumber(){
      bodyEl.querySelectorAll('tr').forEach((tr,idx)=>{
        tr.querySelector('.index').textContent=idx+1;
      });
    }

    addBtn.addEventListener('click', ()=>addRow());
    clearBtn.addEventListener('click', ()=>{
      if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±ØŸ")){
        bodyEl.innerHTML="";
        localStorage.removeItem('fatoraRows');
        calc();
      }
    });

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ†
    loadData();
    if(bodyEl.querySelectorAll('tr').length===0){ addRow(); addRow(); }
  </script>
</body>
</html>